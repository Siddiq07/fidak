<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Art Fest | Login</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(160deg,#eef2ff,#fff);
  font-family:system-ui;
}
.card-ui{
  width:100%;
  max-width:420px;
  background:#fff;
  border-radius:26px;
  padding:26px;
  box-shadow:0 20px 50px rgba(0,0,0,.15);
}
.logo{text-align:center;margin-bottom:18px}
.logo h2{font-weight:800;margin:10px 0}
.btn-main{width:100%;padding:14px;border-radius:14px;font-weight:600}
.score-item{display:flex;justify-content:space-between;border-bottom:1px dashed #ddd;padding:4px 0}
</style>
</head>

<body>

<div class="card-ui">
  <div class="logo">
    <h2>Art Fest</h2>
    <small class="text-muted">Login Portal</small>
  </div>

  <button class="btn btn-primary btn-main mb-2" onclick="openLogin('admin')">Admin Login</button>
  <button class="btn btn-success btn-main mb-2" onclick="openLogin('leader')">Leader Login</button>
  <button class="btn btn-outline-primary btn-main" onclick="openLogin('student')">Participant Login</button>

  <hr>

  <h6>Live Team Scores</h6>
  <div id="scores"></div>
</div>

<!-- LOGIN MODAL -->
<div class="modal fade" id="loginModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="loginTitle"></h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <div id="adminBox" class="d-none">
          <input id="adminUser" class="form-control mb-2" placeholder="Username">
          <input id="adminPass" type="password" class="form-control" placeholder="Password">
        </div>

        <div id="leaderBox" class="d-none">
          <select id="leaderTeam" class="form-select mb-2"></select>
          <input id="leaderPass" type="password" class="form-control" placeholder="Team Password">
        </div>

        <div id="studentBox" class="d-none">
          <input id="studentChess" class="form-control" placeholder="Chess Number">
        </div>

        <div id="error" class="text-danger mt-2"></div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-primary w-100" onclick="doLogin()">Login</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getDatabase, ref, get, onValue } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

const firebaseConfig={
  apiKey:"AIzaSyBMDGNukeonNa_-PWB-5cTO4GMofd3vyiM",
  databaseURL:"https://gen7-3e139-default-rtdb.firebaseio.com",
  projectId:"gen7-3e139"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const modal=new bootstrap.Modal(document.getElementById("loginModal"));
let mode="";

window.openLogin=(m)=>{
  mode=m;
  error.innerText="";
  adminBox.classList.add("d-none");
  leaderBox.classList.add("d-none");
  studentBox.classList.add("d-none");

  if(m==="admin"){ loginTitle.innerText="Admin Login"; adminBox.classList.remove("d-none"); }
  if(m==="leader"){ loginTitle.innerText="Leader Login"; leaderBox.classList.remove("d-none"); loadTeams(); }
  if(m==="student"){ loginTitle.innerText="Participant Login"; studentBox.classList.remove("d-none"); }

  modal.show();
};

async function loadTeams(){
  const snap=await get(ref(db,"teams"));
  leaderTeam.innerHTML="";
  Object.values(snap.val()||{}).forEach(t=>{
    leaderTeam.innerHTML+=`<option value="${t.id}">${t.name}</option>`;
  });
}

window.doLogin=async()=>{
  try{
    if(mode==="admin"){
      const s=await get(ref(db,"config/admin"));
      if(adminUser.value===s.val().username && adminPass.value===s.val().password){
        sessionStorage.setItem("auth",JSON.stringify({role:"Admin"}));
        location.href="admin.html";
      } else error.innerText="Invalid admin credentials";
    }

    if(mode==="leader"){
      const t=leaderTeam.value;
      const s=await get(ref(db,"teams/"+t));
      if(leaderPass.value===s.val().password){
        sessionStorage.setItem("auth",JSON.stringify({role:"Leader",teamId:t}));
        location.href="leader.html";
      } else error.innerText="Wrong team password";
    }

    if(mode==="student"){
      const s=await get(ref(db,"students/"+studentChess.value));
      if(s.exists()){
        sessionStorage.setItem("auth",JSON.stringify({role:"Participant",studentId:studentChess.value}));
        location.href="participant.html";
      } else error.innerText="Chess number not found";
    }
  }catch(e){ error.innerText="Connection error"; }
};

onValue(ref(db,"teams"),snap=>{
  scores.innerHTML="";
  Object.values(snap.val()||{}).forEach(t=>{
    scores.innerHTML+=`<div class="score-item"><span>${t.name}</span><b>${t.score||0}</b></div>`;
  });
});
</script>

</body>
</html>