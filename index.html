<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Art Fest ‚Äî Login</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

<style>
body{
  background: linear-gradient(135deg,#eef2ff,#f8fafc);
  font-family: system-ui, -apple-system, "Segoe UI", Roboto;
}
.brand{
  font-weight:800;
  color:#1d4ed8;
}
.login-card{
  border-radius:14px;
  transition:.25s;
}
.login-card:hover{
  transform: translateY(-6px);
  box-shadow:0 18px 40px rgba(15,23,42,.08);
}
.score-card{
  background:#fff;
  border-radius:14px;
  padding:14px;
  box-shadow:0 10px 30px rgba(15,23,42,.05);
  animation:fadeIn .6s ease;
}
.score{
  font-size:34px;
  font-weight:900;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}
footer{
  color:#64748b;
  font-size:13px;
}
</style>
</head>
<body>

<nav class="navbar bg-white shadow-sm">
  <div class="container">
    <span class="navbar-brand brand">
      üé® Art Fest Management
    </span>
    <span class="text-muted small">Live System</span>
  </div>
</nav>

<main class="container py-4">

<!-- LOGIN CARDS -->
<div class="row g-4 justify-content-center">

  <!-- ADMIN -->
  <div class="col-md-4">
    <div class="card login-card p-4 text-center">
      <i class="bi bi-shield-lock fs-1 text-primary"></i>
      <h5 class="mt-2">Admin</h5>
      <button class="btn btn-primary mt-3" onclick="loginAdmin()">Login</button>
    </div>
  </div>

  <!-- LEADER -->
  <div class="col-md-4">
    <div class="card login-card p-4 text-center">
      <i class="bi bi-people-fill fs-1 text-success"></i>
      <h5 class="mt-2">Team Leader</h5>
      <button class="btn btn-success mt-3" onclick="loginLeader()">Login</button>
    </div>
  </div>

  <!-- PARTICIPANT -->
  <div class="col-md-4">
    <div class="card login-card p-4 text-center">
      <i class="bi bi-person-fill fs-1 text-info"></i>
      <h5 class="mt-2">Participant</h5>
      <button class="btn btn-info mt-3" onclick="loginParticipant()">Login</button>
    </div>
  </div>

</div>

<!-- LIVE SCORE -->
<section class="mt-5">
  <h4 class="text-center mb-3">üèÜ Live Team Scores</h4>
  <div id="scoreGrid" class="row g-3"></div>
</section>

<footer class="text-center mt-5">
  ¬© <span id="year"></span> Art Fest
</footer>

</main>

<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyBMDGNukeonNa_-PWB-5cTO4GMofd3vyiM",
  authDomain: "gen7-3e139.firebaseapp.com",
  databaseURL: "https://gen7-3e139-default-rtdb.firebaseio.com",
  projectId: "gen7-3e139",
  storageBucket: "gen7-3e139.firebasestorage.app",
  messagingSenderId: "578412378966",
  appId: "1:578412378966:web:f76c1e69a01a4bbfbd74f7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* helpers */
const $ = id => document.getElementById(id);

/* ---------------- LIVE SCORE ---------------- */
onValue(ref(db,'teams'), snap=>{
  const grid = $('scoreGrid');
  grid.innerHTML='';
  const teams = Object.values(snap.val()||{});
  teams
    .sort((a,b)=>(b.score||0)-(a.score||0))
    .forEach(t=>{
      const div=document.createElement('div');
      div.className='col-md-3';
      div.innerHTML=`
        <div class="score-card text-center">
          <div class="fw-bold">${t.name||'Team'}</div>
          <div class="score">${t.score||0}</div>
        </div>`;
      grid.appendChild(div);
    });
});

/* ---------------- LOGIN ---------------- */

window.loginAdmin = async ()=>{
  const pwd = prompt("Admin Password");
  if(!pwd) return;

  const snap = await get(ref(db,'settings/adminPassword'));
  if(snap.exists() && snap.val()===pwd){
    sessionStorage.setItem('USER',JSON.stringify({role:'admin'}));
    location.href='admin.html';
  } else alert("Wrong password");
};

window.loginLeader = async ()=>{
  const teamId = prompt("Team ID");
  const pwd = prompt("Team Password");
  if(!teamId || !pwd) return;

  const snap = await get(ref(db,`teams/${teamId}`));
  if(!snap.exists()) return alert("Team not found");

  const t=snap.val();
  if(t.password===pwd){
    sessionStorage.setItem('USER',JSON.stringify({role:'leader',teamId}));
    location.href='leader.html';
  } else alert("Wrong password");
};

window.loginParticipant = async ()=>{
  const chess = prompt("Chess Number");
  if(!chess) return;

  const snap = await get(ref(db,`students/${chess}`));
  if(snap.exists()){
    sessionStorage.setItem('USER',JSON.stringify({role:'participant',chess}));
    location.href='participant.html';
  } else alert("Student not found");
};

/* misc */
$('year').textContent=new Date().getFullYear();
</script>

</body>
</html>