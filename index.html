<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Art Fest | Live Score</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

<style>
:root{
  --accent:#facc15;
  --dark:#0b0b0f;
  --glass:rgba(255,255,255,.08);
}
body{
  background:linear-gradient(180deg,#0b0b0f,#12121a);
  color:#fff;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
}
.hero{
  text-align:center;
  padding:70px 20px;
}
.hero h1{
  font-size:54px;
  font-weight:900;
}
.hero h1 span{color:var(--accent)}
.glass{
  background:var(--glass);
  border:1px solid rgba(255,255,255,.12);
  border-radius:18px;
  padding:24px;
}
.stat{
  font-size:42px;
  font-weight:900;
  color:var(--accent);
}
.team-card{
  background:var(--glass);
  border-radius:16px;
  padding:18px;
  text-align:center;
  transition:.25s;
}
.team-card:hover{transform:translateY(-6px)}
.score{
  font-size:38px;
  font-weight:900;
  color:var(--accent);
}
button{
  border-radius:14px!important;
}
</style>
</head>

<body>

<!-- HERO -->
<div class="hero">
  <h1>Art <span>Fest</span></h1>
  <p class="text-muted">Live Scoreboard & Login Portal</p>
</div>

<!-- LOGIN -->
<div class="container mb-5">
  <div class="row g-3 justify-content-center">
    <div class="col-md-3">
      <button class="btn btn-warning w-100" onclick="loginAdmin()">Admin Login</button>
    </div>
    <div class="col-md-3">
      <button class="btn btn-outline-light w-100" onclick="loginLeader()">Leader Login</button>
    </div>
    <div class="col-md-3">
      <button class="btn btn-outline-info w-100" onclick="loginParticipant()">Participant Login</button>
    </div>
  </div>
</div>

<!-- STATS -->
<div class="container mb-5">
  <div class="row g-4 text-center">
    <div class="col-md-4">
      <div class="glass">
        <div id="statStudents" class="stat">0</div>
        Students
      </div>
    </div>
    <div class="col-md-4">
      <div class="glass">
        <div id="statEvents" class="stat">0</div>
        Programs
      </div>
    </div>
    <div class="col-md-4">
      <div class="glass">
        <div id="statTeams" class="stat">0</div>
        Teams
      </div>
    </div>
  </div>
</div>

<!-- LIVE SCORE -->
<div class="container pb-5">
  <h3 class="mb-4 text-center">üèÜ Live Team Scores</h3>
  <div id="scoreGrid" class="row g-4"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyBMDGNukeonNa_-PWB-5cTO4GMofd3vyiM",
  authDomain: "gen7-3e139.firebaseapp.com",
  databaseURL: "https://gen7-3e139-default-rtdb.firebaseio.com",
  projectId: "gen7-3e139",
  storageBucket: "gen7-3e139.firebasestorage.app",
  messagingSenderId: "578412378966",
  appId: "1:578412378966:web:f76c1e69a01a4bbfbd74f7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* Stats */
onValue(ref(db,'students'),s=>statStudents.textContent=Object.keys(s.val()||{}).length);
onValue(ref(db,'events'),s=>statEvents.textContent=Object.keys(s.val()||{}).length);
onValue(ref(db,'teams'),s=>statTeams.textContent=Object.keys(s.val()||{}).length);

/* Live Scores */
const grid=document.getElementById('scoreGrid');
let PREV={};

onValue(ref(db,'teams'),snap=>{
  const teams=Object.values(snap.val()||{});
  teams.sort((a,b)=>(b.score||0)-(a.score||0));
  grid.innerHTML='';
  teams.forEach(t=>{
    const card=document.createElement('div');
    card.className='col-md-3';
    card.innerHTML=`
      <div class="team-card">
        <h5>${t.name||t.id}</h5>
        <div class="score" id="s-${t.id}">0</div>
      </div>`;
    grid.appendChild(card);
    animate(`s-${t.id}`,PREV[t.id]||0,t.score||0);
    PREV[t.id]=t.score||0;
  });
});

function animate(id,from,to){
  const el=document.getElementById(id);
  let start=null;
  function step(ts){
    if(!start)start=ts;
    const p=Math.min((ts-start)/600,1);
    el.textContent=Math.floor(from+(to-from)*p);
    if(p<1)requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* Login */
function loginAdmin(){
  const p=prompt("Admin Password");
  if(p==="1234") location.href="admin.html";
  else alert("Wrong password");
}
function loginLeader(){
  const team=prompt("Team ID");
  const p=prompt("Team Password");
  if(team&&p) location.href=`leader.html?team=${team}`;
}
function loginParticipant(){
  const c=prompt("Chess Number");
  if(c) location.href=`participant.html?chess=${c}`;
}

window.loginAdmin=loginAdmin;
window.loginLeader=loginLeader;
window.loginParticipant=loginParticipant;
</script>

</body>
</html>