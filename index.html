<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Art Fest | Login</title>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

<style>
:root{
  --primary:#4f46e5;
  --dark:#0f172a;
  --soft:#f1f5f9;
}
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(160deg,#eef2ff,#ffffff);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
}
.app{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card-ui{
  width:100%;
  max-width:420px;
  background:white;
  border-radius:28px;
  padding:28px;
  box-shadow:0 30px 80px rgba(0,0,0,.12);
}
.logo{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
}
.logo img{
  width:80px;
}
.logo h2{
  margin:0;
  font-weight:800;
  color:var(--dark);
}
.btn-main{
  width:100%;
  padding:14px;
  border-radius:14px;
  font-weight:600;
}
.btn-outline{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:2px solid var(--primary);
  color:var(--primary);
  font-weight:600;
  background:white;
}
.stats{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
  margin-top:22px;
}
.stat{
  background:var(--soft);
  border-radius:14px;
  padding:14px;
  text-align:center;
}
.stat h3{
  margin:0;
  font-weight:800;
}
.stat span{
  font-size:12px;
  color:#64748b;
}
.scoreboard{
  margin-top:20px;
}
.score-item{
  display:flex;
  justify-content:space-between;
  padding:10px 0;
  border-bottom:1px dashed #e5e7eb;
}
.score-item:last-child{border-bottom:none}
</style>
</head>

<body>
<div class="app">
  <div class="card-ui">

    <!-- LOGO -->
    <div class="logo mb-4">
      <img src="logo.png" alt="Logo">
      <h2>Art Fest</h2>
      <small class="text-muted">Management Portal</small>
    </div>

    <!-- LOGIN BUTTONS -->
    <div class="d-grid gap-3">
      <button class="btn btn-main btn-primary" id="btnAdmin">
        <i class="bi bi-shield-lock me-2"></i> Admin Login
      </button>

      <button class="btn btn-main btn-success" id="btnLeader">
        <i class="bi bi-people me-2"></i> Leader Login
      </button>

      <button class="btn btn-outline" id="btnParticipant">
        <i class="bi bi-person me-2"></i> Participant Login
      </button>
    </div>

    <!-- STATS -->
    <div class="stats">
      <div class="stat">
        <h3 id="statStudents">0</h3>
        <span>Students</span>
      </div>
      <div class="stat">
        <h3 id="statEvents">0</h3>
        <span>Programs</span>
      </div>
      <div class="stat">
        <h3 id="statTeams">0</h3>
        <span>Teams</span>
      </div>
    </div>

    <!-- LIVE SCORE -->
    <div class="scoreboard">
      <h6 class="fw-bold mb-2">Live Team Score</h6>
      <div id="scoreList"></div>
    </div>

  </div>
</div>

<!-- LOGIN MODAL -->
<div class="modal fade" id="loginModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      <form id="loginForm">
        <div class="modal-header">
          <h5 class="modal-title" id="loginTitle"></h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" id="loginType">

          <div id="teamBox" class="mb-3 d-none">
            <label class="form-label">Team</label>
            <select id="teamSelect" class="form-select"></select>
          </div>

          <div id="chessBox" class="mb-3 d-none">
            <label class="form-label">Chess Number</label>
            <input id="chessInput" class="form-control">
          </div>

          <div class="mb-3">
            <label class="form-label">Password</label>
            <input id="passwordInput" type="password" class="form-control">
          </div>

          <div id="loginError" class="text-danger small d-none"></div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-primary w-100" type="submit">Login</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Bootstrap JS (MUST COME BEFORE CUSTOM JS) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Firebase + Logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBMDGNukeonNa_-PWB-5cTO4GMofd3vyiM",
  databaseURL: "https://gen7-3e139-default-rtdb.firebaseio.com",
  projectId: "gen7-3e139"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// DOM refs
const statStudents = document.getElementById("statStudents");
const statEvents   = document.getElementById("statEvents");
const statTeams    = document.getElementById("statTeams");
const scoreList    = document.getElementById("scoreList");
const teamSelect   = document.getElementById("teamSelect");

// Stats
onValue(ref(db,"students"),s=>statStudents.textContent=Object.keys(s.val()||{}).length);
onValue(ref(db,"events"),s=>statEvents.textContent=Object.keys(s.val()||{}).length);
onValue(ref(db,"teams"),s=>{
  const teams=s.val()||{};
  statTeams.textContent=Object.keys(teams).length;
  teamSelect.innerHTML='<option value="">Select Team</option>';
  Object.values(teams).forEach(t=>{
    teamSelect.innerHTML+=`<option value="${t.id}">${t.name}</option>`;
  });
});

// Live Score
onValue(ref(db,"teams"),snap=>{
  scoreList.innerHTML='';
  Object.values(snap.val()||{})
    .sort((a,b)=>(b.score||0)-(a.score||0))
    .forEach(t=>{
      scoreList.innerHTML+=`
        <div class="score-item">
          <strong>${t.name}</strong>
          <span>${t.score||0}</span>
        </div>`;
    });
});
</script>

<!-- UI LOGIC -->
<script>
const modal = new bootstrap.Modal(document.getElementById("loginModal"));

const loginType = document.getElementById("loginType");
const loginTitle = document.getElementById("loginTitle");
const teamBox = document.getElementById("teamBox");
const chessBox = document.getElementById("chessBox");

document.getElementById("btnAdmin").onclick = ()=>openLogin("admin");
document.getElementById("btnLeader").onclick = ()=>openLogin("leader");
document.getElementById("btnParticipant").onclick = ()=>openLogin("participant");

function openLogin(type){
  loginType.value = type;
  teamBox.classList.toggle("d-none", type !== "leader");
  chessBox.classList.toggle("d-none", type !== "participant");
  loginTitle.textContent = type.charAt(0).toUpperCase()+type.slice(1)+" Login";
  modal.show();
}

document.getElementById("loginForm").onsubmit = e=>{
  e.preventDefault();
  const t = loginType.value;
  if(t==="admin") location.href="admin.html";
  if(t==="leader") location.href="leader.html";
  if(t==="participant") location.href="participant.html";
};
</script>

</body>
</html>