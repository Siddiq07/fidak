<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Art Fest — Leader Login</title>

<!-- Bootstrap + Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

<style>
:root{
  --accent:#2563eb;
  --accent2:#7c3aed;
  --bg:#f5f8ff;
  --card:#ffffff;
  --muted:#6b7280;
}
body{
  background:var(--bg);
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
}
.login-container{
  max-width:380px;
  margin:60px auto;
  padding:22px;
}
.card-neo{
  background:var(--card);
  padding:22px;
  border-radius:14px;
  box-shadow:0 10px 32px rgba(0,0,0,0.06);
}
.brand{
  font-weight:800;
  font-size:26px;
  color:var(--accent);
}
.btn-accent{
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  color:#fff;
  border:0;
  font-weight:600;
}
.input-icon{
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  color:var(--muted);
}
.input-with-icon{
  padding-left:38px;
}
.small-text{font-size:13px;color:var(--muted);}
</style>
</head>

<body>

<div class="login-container">
  <div class="text-center mb-4">
    <div class="brand"><i class="bi bi-palette-fill"></i> Art Fest</div>
    <div class="small-text">Leader Login</div>
  </div>

  <div class="card-neo">

    <label class="form-label">Chess Number</label>
    <div style="position:relative">
      <i class="bi bi-person input-icon"></i>
      <input id="loginChess" class="form-control input-with-icon" placeholder="Enter Chess #" autocomplete="off">
    </div>

    <label class="form-label mt-3">Team Password</label>
    <div style="position:relative">
      <i class="bi bi-lock input-icon"></i>
      <input id="loginPassword" type="password" class="form-control input-with-icon" placeholder="Team password">
    </div>

    <button id="loginBtn" class="btn btn-accent w-100 mt-4 py-2">Login</button>

    <div id="loginMsg" class="text-danger small-text mt-3"></div>

  </div>
</div>

<!-- Firebase + Login Script -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBMDGNukeonNa_-PWB-5cTO4GMofd3vyiM",
  authDomain: "gen7-3e139.firebaseapp.com",
  databaseURL: "https://gen7-3e139-default-rtdb.firebaseio.com",
  projectId: "gen7-3e139",
  storageBucket: "gen7-3e139.firebasestorage.app",
  messagingSenderId: "578412378966",
  appId: "1:578412378966:web:f76c1e69a01a4bbfbd74f7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const $ = id => document.getElementById(id);

$('loginBtn').addEventListener('click', loginLeader);

async function loginLeader(){
  const chess = $('loginChess').value.trim();
  const pass = $('loginPassword').value.trim();
  const msg = $('loginMsg');
  msg.innerHTML = "";

  if(!chess || !pass){
    msg.innerHTML = "Enter Chess # and Password.";
    return;
  }

  const teamsSnap = await get(ref(db, 'teams'));
  const teams = teamsSnap.val() || {};

  let teamFound = null;

  // find team with leader ID match
  Object.values(teams).forEach(t => {
    if(String(t.leaderId) === chess){
      teamFound = t;
    }
  });

  if(!teamFound){
    msg.innerHTML = "Leader not found.";
    return;
  }

  if((teamFound.password || "") !== pass){
    msg.innerHTML = "Incorrect password.";
    return;
  }

  // ✔ store to session
  sessionStorage.setItem("leaderId", chess);

  // ✔ redirect leader to his team only
  window.location.href = "leader.html?leader=" + encodeURIComponent(chess);
}
</script>

</body>
</html>