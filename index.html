<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Art Fest â€” Home</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

<style>
:root{
  --bg:#0f0f0f;
  --card:#1a1a1a;
  --accent:#f5c518;
  --muted:#9ca3af;
}
body{
  background: radial-gradient(circle at top,#1f1f1f,#0a0a0a);
  color:#fff;
  font-family:Inter,system-ui;
}
.hero{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:20px;
}
.logo{
  font-size:42px;
  font-weight:900;
  letter-spacing:1px;
}
.tagline{
  color:var(--accent);
  margin-top:6px;
  letter-spacing:3px;
  font-size:13px;
}
.buttons{
  margin-top:30px;
  display:flex;
  gap:14px;
  flex-wrap:wrap;
  justify-content:center;
}
.btn-main{
  background:var(--accent);
  border:none;
  padding:14px 28px;
  border-radius:30px;
  font-weight:700;
}
.btn-outline-main{
  border:2px solid var(--accent);
  color:var(--accent);
  padding:12px 26px;
  border-radius:30px;
  background:transparent;
}
.stats{
  margin-top:40px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:16px;
  width:100%;
  max-width:800px;
}
.stat{
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:16px;
  padding:18px;
}
.stat .num{
  font-size:34px;
  font-weight:900;
  color:var(--accent);
}
.stat .label{
  color:var(--muted);
  font-size:13px;
  margin-top:6px;
}
.scoreboard{
  margin-top:40px;
  width:100%;
  max-width:900px;
}
.team-row{
  display:flex;
  justify-content:space-between;
  padding:10px 14px;
  border-bottom:1px solid rgba(255,255,255,0.08);
}
.team-name{
  font-weight:600;
}
.team-score{
  font-weight:800;
  color:var(--accent);
}
</style>
</head>
<body>

<div class="hero">
  <div class="logo">QA<span style="color:var(--accent)">UF</span></div>
  <div class="tagline">RECTIFYING THE VIRTUOUS</div>

  <div class="buttons">
    <button class="btn-main" onclick="loginAdmin()">Admin Login</button>
    <button class="btn-outline-main" onclick="loginLeader()">Leader Login</button>
    <button class="btn-outline-main" onclick="loginParticipant()">Participant</button>
  </div>

  <div class="stats">
    <div class="stat">
      <div id="countStudents" class="num">0</div>
      <div class="label">Students</div>
    </div>
    <div class="stat">
      <div id="countEvents" class="num">0</div>
      <div class="label">Programs</div>
    </div>
    <div class="stat">
      <div id="countTeams" class="num">0</div>
      <div class="label">Teams</div>
    </div>
  </div>

  <div class="scoreboard">
    <h5 class="mt-4 mb-2 text-center">Live Team Scores</h5>
    <div id="scoreList"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBMDGNukeonNa_-PWB-5cTO4GMofd3vyiM",
  authDomain: "gen7-3e139.firebaseapp.com",
  databaseURL: "https://gen7-3e139-default-rtdb.firebaseio.com",
  projectId: "gen7-3e139",
  storageBucket: "gen7-3e139.firebasestorage.app",
  messagingSenderId: "578412378966",
  appId: "1:578412378966:web:f76c1e69a01a4bbfbd74f7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const $ = id => document.getElementById(id);

/* ---------- COUNTS ---------- */
onValue(ref(db,'students'), s=>{
  $('countStudents').textContent = Object.keys(s.val()||{}).length;
});
onValue(ref(db,'events'), s=>{
  $('countEvents').textContent = Object.keys(s.val()||{}).length;
});
onValue(ref(db,'teams'), s=>{
  $('countTeams').textContent = Object.keys(s.val()||{}).length;
});

/* ---------- LIVE SCORE ---------- */
onValue(ref(db,'teams'), snap=>{
  const box = $('scoreList');
  box.innerHTML = '';
  const teams = Object.values(snap.val()||{});
  teams.sort((a,b)=>(b.score||0)-(a.score||0));
  teams.forEach(t=>{
    box.innerHTML += `
      <div class="team-row">
        <div class="team-name">${t.name||t.id}</div>
        <div class="team-score">${t.score||0}</div>
      </div>`;
  });
});

/* ---------- LOGIN FUNCTIONS ---------- */
window.loginAdmin = async ()=>{
  const p = prompt("Admin password");
  if(!p) return;
  const s = await get(ref(db,'settings'));
  if(s.exists() && s.val().adminPassword === p){
    sessionStorage.setItem('USER',JSON.stringify({role:'admin'}));
    location.href='admin.html';
  } else alert("Wrong password");
};

window.loginLeader = async ()=>{
  const tid = prompt("Team ID");
  const pw = prompt("Team password");
  if(!tid||!pw) return;

  const s = await get(ref(db,'teams'));
  let ok=null;
  Object.values(s.val()||{}).forEach(t=>{
    if(String(t.id)===tid && String(t.password||'')===pw) ok=t;
  });
  if(ok){
    sessionStorage.setItem('USER',JSON.stringify({role:'leader',teamId:ok.id}));
    location.href='leader.html';
  } else alert("Invalid team or password");
};

window.loginParticipant = async ()=>{
  const c = prompt("Chess number");
  if(!c) return;
  const s = await get(ref(db,'students'));
  let ok=null;
  Object.values(s.val()||{}).forEach(st=>{
    if(String(st.id)===c) ok=st;
  });
  if(ok){
    sessionStorage.setItem('USER',JSON.stringify({role:'participant',chess:ok.id}));
    location.href='participant.html';
  } else alert("Chess number not found");
};
</script>

</body>
</html>