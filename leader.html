<!-- PART 1 -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Leader — Art Fest</title>

<!-- Bootstrap + icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

<!-- Export tools -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root{
  --bg:#f5f8ff;
  --card:#fff;
  --muted:#6b7280;
  --accent:#2563eb;
  --accent2:#7c3aed;
  --success:#10b981;
  --danger:#ef4444;
}
html,body{background:var(--bg);margin:0;font-family:Inter,system-ui}
.card-neo{background:var(--card);border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,0.05);margin-bottom:14px}
.section-title{font-weight:700;margin-bottom:8px}
.muted{color:var(--muted)}
.muted-small{color:var(--muted);font-size:13px}

.btn-accent{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;border:0}

.small-box{
  width:55px;height:55px;border-radius:10px;
  background:#eef2ff;
  display:flex;align-items:center;justify-content:center;
  margin:6px;cursor:pointer;font-weight:700;
}
.small-box.selected{background:var(--accent);color:white}

.top-nav{background:white;border-bottom:1px solid #e8eefb;
        box-shadow:0 4px 12px rgba(0,0,0,0.04)}
.brand{font-weight:800;color:var(--accent)}
.leader-avatar{width:46px;height:46px;border-radius:8px;background:#eef2ff;
               display:flex;align-items:center;justify-content:center;
               font-weight:700;font-size:20px;color:var(--accent)}

.stats-grid{display:flex;gap:12px;flex-wrap:wrap}
.stat{flex:1;min-width:130px;padding:12px;background:white;border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.05)}
.stat .big{font-size:22px;font-weight:800}

.participated-row{background:#e8fff0}

</style>
</head>

<body>

<!-- ========== NAVBAR ========== -->
<nav class="top-nav">
  <div class="container d-flex justify-content-between py-2">
    <div class="brand d-flex align-items-center gap-2">
      <i class="bi bi-palette-fill fs-4"></i> Art Fest — Leader
    </div>
    <div>
      <button id="btnLogout" class="btn btn-outline-danger">Logout</button>
    </div>
  </div>

  <div class="container d-flex gap-2 py-2">
    <button class="btn btn-light nav-btn active" data-target="#panel-login">Login</button>
    <button class="btn btn-light nav-btn" data-target="#panel-dashboard">Dashboard</button>
    <button class="btn btn-light nav-btn" data-target="#panel-events">Events</button>
    <button class="btn btn-light nav-btn" data-target="#panel-results">Results</button>
    <button class="btn btn-light nav-btn" data-target="#panel-team">Team</button>
  </div>
</nav>

<main class="container mt-3">

<div id="toastRoot" class="position-fixed bottom-0 end-0 p-3"></div>

<!-- ========== LOGIN PANEL ========== -->
<section id="panel-login" class="card-neo">
  <div class="section-title">Leader Login</div>
  <div class="muted-small mb-2">Login using Chess Number & Team Password</div>

  <input id="leaderChess" class="form-control mb-2" placeholder="Leader Chess #">
  <input id="leaderPassword" class="form-control mb-2" placeholder="Team Password">

  <button id="btnLeaderLogin" class="btn btn-accent w-100">Login</button>
  <div id="loginNotice" class="muted-small mt-2"></div>
</section>
<!-- ---------- PART 2: DASHBOARD / EVENTS / RESULTS / TEAM PANELS ---------- -->

<!-- DASHBOARD -->
<section id="panel-dashboard" class="card-neo d-none">
  <div class="d-flex justify-content-between align-items-start">
    <div>
      <div class="d-flex gap-3 align-items-center">
        <div id="leaderAvatar" class="leader-avatar">G</div>
        <div>
          <div id="leaderName" style="font-weight:800">Guest</div>
          <div id="leaderTeamName" class="muted-small">Team: -</div>
        </div>
      </div>

      <div id="lockedBanner" class="muted-small text-danger mt-2 d-none">Your team is locked by admin.</div>
    </div>

    <div style="min-width:240px">
      <div class="stats-grid">
        <div class="stat">
          <div class="muted-small">Team Score</div>
          <div id="statScore" class="big">0</div>
        </div>
        <div class="stat">
          <div class="muted-small">Attendance %</div>
          <div id="statAttendance" class="big">0%</div>
        </div>
        <div class="stat">
          <div class="muted-small">Members</div>
          <div id="statMembers" class="big">0</div>
        </div>
      </div>
      <div class="mt-2 text-end">
        <button id="btnDownloadTeamPdf" class="btn btn-outline-secondary">Export Team PDF</button>
      </div>
    </div>
  </div>

  <hr>

  <div class="row g-3">
    <div class="col-md-6">
      <div class="card-neo">
        <div class="section-title">Team Members</div>
        <div id="teamMembersList" style="max-height:360px;overflow:auto"></div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card-neo">
        <div class="section-title">Quick Info</div>
        <div id="quickInfoList" class="muted-small">
          <div>Added Events: <strong id="quickAdded">0</strong></div>
          <div>Pending Submissions: <strong id="quickPending">0</strong></div>
          <div>Approved Submissions: <strong id="quickApproved">0</strong></div>
        </div>

        <hr>
        <div class="section-title">All Students (reference)</div>
        <div id="allStudentsBox" style="max-height:160px;overflow:auto"></div>
      </div>
    </div>
  </div>
</section>

<!-- EVENTS PANEL -->
<section id="panel-events" class="card-neo d-none">
  <div class="section-title">Events — choose and submit participants</div>

  <div class="row g-3">
    <div class="col-lg-5">
      <div class="card-neo">
        <label class="form-label muted-small">Search / Filter</label>
        <div class="d-flex gap-2 mb-2">
          <input id="eventSearch" class="form-control" placeholder="Search by name / type / level">
          <select id="filterType" class="form-select"><option value="">All Types</option><option>Stage</option><option>Off-Stage</option></select>
          <select id="filterLevel" class="form-select"><option value="">All Levels</option><option>Junior</option><option>Senior</option><option>General</option><option>Special</option></select>
        </div>

        <div class="section-title">Available Events</div>
        <div class="table-responsive" style="max-height:420px;overflow:auto">
          <table class="table table-sm">
            <thead class="table-light"><tr><th>Name</th><th>Type</th><th>Level</th><th></th></tr></thead>
            <tbody id="eventsList"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-lg-7">
      <div class="card-neo">
        <div class="section-title">Selected Event</div>
        <div id="selectedEventWrap" class="muted-small mb-2">Select an event to load team members for nomination.</div>
        <div id="selectedEventName" style="font-weight:800"></div>
        <div id="selectedEventMeta" class="muted-small mb-3"></div>

        <div class="section-title">Team members (click chess # to select)</div>
        <div id="membersSelection" style="min-height:220px;max-height:360px;overflow:auto;padding:6px;display:flex;flex-wrap:wrap"></div>

        <div class="mt-3 d-flex gap-2">
          <button id="btnSubmitParticipation" class="btn btn-accent">Submit Participation</button>
          <button id="btnClearSelection" class="btn btn-outline-secondary">Clear</button>
          <div class="ms-auto muted-small align-self-center" id="selectionInfo">0 selected</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- RESULTS PANEL -->
<section id="panel-results" class="card-neo d-none">
  <div class="section-title">Results (Published)</div>
  <div class="muted-small mb-2">Light rows indicate event has some results uploaded (draft or published).</div>
  <div class="table-responsive">
    <table class="table align-middle">
      <thead class="table-light"><tr><th>Event</th><th>1st</th><th>2nd</th><th>3rd</th><th>Published</th></tr></thead>
      <tbody id="leaderResultsTable"></tbody>
    </table>
  </div>
</section>

<!-- TEAM PANEL -->
<section id="panel-team" class="card-neo d-none">
  <div class="section-title">Team Info</div>
  <div id="teamInfoWrap" class="muted-small mb-2"></div>

  <div class="section-title">Members</div>
  <div id="teamMembersSmall" style="max-height:360px;overflow:auto"></div>
</section>

<!-- keep panels end here; PART 3 (modals + hidden) follows next -->
<!-- ---------- PART 3 : HIDDEN STATE + MODALS ---------- -->

<!-- Hidden state -->
<input type="hidden" id="leaderTeamDbKey">
<input type="hidden" id="leaderTeamId">
<input type="hidden" id="leaderStudentId">

<!-- Participation Modal -->
<div class="modal fade" id="participationStatusModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Your Team Submissions</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body" style="max-height:420px;overflow:auto">
        <div id="yourSubmissionsList" class="muted-small"></div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<!-- Student Name Popup (for small-box click) -->
<div class="modal fade" id="studentNameModal" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content text-center">

      <div class="modal-header">
        <h5 class="modal-title">Student Info</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div id="studentModalName" style="font-weight:700;font-size:18px"></div>
        <div id="studentModalChess" class="muted-small mt-1"></div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-accent" data-bs-dismiss="modal">OK</button>
      </div>

    </div>
  </div>
</div>

<!-- Popup: Limit Reached -->
<div class="modal fade" id="limitModal" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content text-center">
      <div class="modal-header">
        <h5 class="modal-title text-danger">Limit Reached</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="limitModalText" class="muted-small"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-accent" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getDatabase, ref, push, set, update, onValue } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

/* Firebase config (same as admin) */
const firebaseConfig = {
  apiKey: "AIzaSyBMDGNukeonNa_-PWB-5cTO4GMofd3vyiM",
  authDomain: "gen7-3e139.firebaseapp.com",
  databaseURL: "https://gen7-3e139-default-rtdb.firebaseio.com",
  projectId: "gen7-3e139",
  storageBucket: "gen7-3e139.firebasestorage.app",
  messagingSenderId: "578412378966",
  appId: "1:578412378966:web:f76c1e69a01a4bbfbd74f7",
  measurementId: "G-QLW5J1HK94"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* helpers */
const $ = id => document.getElementById(id);
function toast(msg, type='success'){
  const el=document.createElement('div');
  el.className=`toast align-items-center text-bg-${type} border-0`;
  el.innerHTML=`<div class="d-flex"><div class="toast-body">${msg}</div>
  <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>`;
  $('toastRoot').appendChild(el);
  const t=new bootstrap.Toast(el,{delay:2400});
  t.show();
  el.addEventListener('hidden.bs.toast',()=>el.remove());
}
function escapeHtml(s){return String(s||'').replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");}

/* Cache */
let CACHE = { students:[], teams:[], events:[], participations:[], results:[], attendance:{} };
let KEYMAP = { teams:{}, students:{}, events:{}, participations:{}, results:{} };

/* Firebase realtime listeners */
onValue(ref(db,'students'), s=>{
  const obj=s.val()||{};
  CACHE.students=Object.values(obj);
  KEYMAP.students={};
  Object.entries(obj).forEach(([k,v])=>{
    if(v && v.id!==undefined) KEYMAP.students[String(v.id)] = k;
  });
  renderAll();
});
onValue(ref(db,'teams'), s=>{
  const obj=s.val()||{};
  CACHE.teams=Object.values(obj);
  KEYMAP.teams={};
  Object.entries(obj).forEach(([k,v])=>{
    if(v && v.id!==undefined) KEYMAP.teams[String(v.id)] = k;
  });
  renderAll();
});
onValue(ref(db,'events'), s=>{
  const obj=s.val()||{};
  CACHE.events=Object.values(obj);
  KEYMAP.events={};
  Object.entries(obj).forEach(([k,v])=>{
    if(v && v.id!==undefined) KEYMAP.events[String(v.id)] = k;
  });
  renderAll();
});
onValue(ref(db,'participations'), s=>{
  const obj=s.val()||{};
  CACHE.participations=Object.values(obj);
  KEYMAP.participations={};
  Object.entries(obj).forEach(([k,v])=>{
    if(v && v.id!==undefined) KEYMAP.participations[String(v.id)] = k;
  });
  renderAll();
});
onValue(ref(db,'results'), s=>{
  const obj=s.val()||{};
  CACHE.results=Object.values(obj);
  KEYMAP.results={};
  Object.entries(obj).forEach(([k,v])=>{
    if(v && v.id!==undefined) KEYMAP.results[String(v.id)] = k;
  });
  renderAll();
});
onValue(ref(db,'attendance'), s=>{
  CACHE.attendance = s.val()||{};
  renderAll();
});

/* Leader state (after login) */
let LEADER = { active:false, leaderId:null, teamId:null };

/* LOGIN LOGIC */
$('btnLeaderLogin')?.addEventListener('click',()=>{
  const cid = $('leaderChess').value.trim();
  const pwd = $('leaderPassword').value.trim();

  if(!cid) return toast("Enter your Chess number","danger");

  const student = CACHE.students.find(s=>String(s.id)===cid);
  if(!student) return toast("Leader not found","danger");

  const team = CACHE.teams.find(t=>String(t.leaderId)===cid);
  if(!team) return toast("You are not assigned as a leader","danger");

  if(String(team.password||"") !== String(pwd))
    return toast("Incorrect password","danger");

  if(team.locked)
    return toast("Your team is locked by admin","danger");

  LEADER = { active:true, leaderId:cid, teamId:String(team.id) };
  $('leaderName').textContent = student.name;
  $('leaderTeamName').textContent = "Team: "+team.name;
  $('leaderAvatar').textContent = student.name[0];

  document.querySelector('[data-target="#panel-dashboard"]').click();
  toast("Login successful");

  renderAll();
});

/* Logout */
$('leaderLogout').addEventListener('click',()=>{
  LEADER={active:false,leaderId:null,teamId:null};
  document.querySelector('[data-target="#panel-dashboard"]').click();
  toast("Reset complete");
  renderAll();
});

/* Navigation */
document.querySelectorAll('.nav-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('main > section').forEach(p=>p.classList.add('d-none'));
    document.querySelector(btn.dataset.target).classList.remove('d-none');

    document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));
    btn.classList.add('active');
  });
});

/* ---------- EVENTS LIST ---------- */
function populateEventsList(){
  const tbody = $('eventsList');
  const q = ($('eventSearch')?.value||"").toLowerCase();
  const t = $('filterType')?.value||"";
  const l = $('filterLevel')?.value||"";

  let html="";
  let events = CACHE.events.sort((a,b)=>a.name.localeCompare(b.name));

  events.forEach(ev=>{
    if(t && ev.type!==t) return;
    if(l && ev.level!==l) return;
    if(q){
      const hay = `${ev.name} ${ev.type} ${ev.level}`.toLowerCase();
      if(!hay.includes(q)) return;
    }

    html += `
      <tr>
        <td>${escapeHtml(ev.name)}</td>
        <td>${escapeHtml(ev.type)}</td>
        <td>${escapeHtml(ev.level)}</td>
        <td class="text-end">
          <button class="btn btn-sm btn-outline-primary btn-select-event" data-id="${ev.id}">Select</button>
        </td>
      </tr>`;
  });

  tbody.innerHTML = html || `<tr><td colspan="4" class="muted-small">No events found</td></tr>`;
}

/* Search triggers */
$('eventSearch').addEventListener('input', populateEventsList);
$('filterType').addEventListener('change', populateEventsList);
$('filterLevel').addEventListener('change', populateEventsList);

/* Click event */
document.addEventListener('click',e=>{
  const b=e.target.closest('.btn-select-event');
  if(!b) return;
  selectEvent(b.dataset.id);
});

/* ---------- SELECT EVENT ---------- */
function selectEvent(evId){
  const ev = CACHE.events.find(x=>String(x.id)===String(evId));
  if(!ev) return toast("Event not found","danger");

  $('selectedEventName').textContent = ev.name;
  $('selectedEventMeta').textContent = `${ev.type} — ${ev.level}`;
  $('membersSelection').dataset.evId = evId;

  if(!LEADER.active)
    return $('membersSelection').innerHTML = `<div class="muted-small">Login required</div>`;

  let members = CACHE.students.filter(s=>String(s.teamId)===String(LEADER.teamId));

  if(ev.level==="Junior")
    members = members.filter(s=>String(s.level).toLowerCase()==="junior");
  else if(ev.level==="Senior")
    members = members.filter(s=>String(s.level).toLowerCase()==="senior");

  let html="";
  members.forEach(m=>{
    html += `
      <div class="small-box" 
           data-id="${m.id}"
           data-name="${escapeHtml(m.name)}"
           data-level="${escapeHtml(m.level)}"
           onclick="showStudentName('${escapeHtml(m.name)}','${escapeHtml(m.id)}')">
        ${escapeHtml(m.id)}
      </div>`;
  });

  $('membersSelection').innerHTML = html;
  updateSelectionInfo();
}

/* ---------- POPUP STUDENT NAME ---------- */
window.showStudentName = (name, id)=>{
  $('studentModalName').textContent = name;
  $('studentModalChess').textContent = "Chess: "+id;
  new bootstrap.Modal($('#studentNameModal')).show();
};

/* ---------- SELECTION LIMITS ---------- */
function updateSelectionInfo(){
  const boxes = document.querySelectorAll("#membersSelection .small-box.selected");
  $('selectionInfo').textContent = boxes.length+" selected";
}

/* click selection */
document.addEventListener("click", e=>{
  const box = e.target.closest(".small-box");
  if(!box || !box.dataset.id) return;
  if(e.target.closest(".info-btn")) return;

  // Toggle selection
  if(box.classList.contains("selected")){
    box.classList.remove("selected");
    return updateSelectionInfo();
  }

  // TEAM LIMIT → only 2 members allowed
  const current = document.querySelectorAll('#membersSelection .small-box.selected').length;
  if(current >= 2){
    $('limitModalText').textContent = "Only 2 members allowed per event.";
    new bootstrap.Modal($('#limitModal')).show();
    return;
  }

  // STUDENT LIMITS
  const chess = box.dataset.id;
  const student = CACHE.students.find(s=>String(s.id)===String(chess));
  if(!student) return;

  const evId = $('membersSelection').dataset.evId;
  const ev = CACHE.events.find(e=>String(e.id)===String(evId));

  // count how many events this student is already in
  const parts = CACHE.participations.filter(p=>String(p.studentId)===chess);
  const stageCount = parts.filter(p=>{
    const evv = CACHE.events.find(x=>String(x.id)===String(p.eventId));
    return evv?.type==="Stage";
  }).length;
  const offCount = parts.filter(p=>{
    const evv = CACHE.events.find(x=>String(x.id)===String(p.eventId));
    return evv?.type!=="Stage";
  }).length;

  // student limits
  let maxStage = (student.level==="Junior"?2:3);
  let maxOff = (student.level==="Junior"?3:4);

  if(ev.type==="Stage" && stageCount >= maxStage){
    $('limitModalText').textContent=`${student.name} already reached Stage limit (${maxStage})`;
    return new bootstrap.Modal($('#limitModal')).show();
  }
  if(ev.type!=="Stage" && offCount >= maxOff){
    $('limitModalText').textContent=`${student.name} reached Off-stage limit (${maxOff})`;
    return new bootstrap.Modal($('#limitModal')).show();
  }

  box.classList.add("selected");
  updateSelectionInfo();
});

/* ---------- SUBMIT PARTICIPATION ---------- */
$('btnSubmitParticipation').addEventListener('click', async ()=>{
  if(!LEADER.active) return toast("Login required","danger");

  const evId = $('membersSelection').dataset.evId;
  if(!evId) return toast("Select event first","danger");

  const selected = [...document.querySelectorAll('#membersSelection .small-box.selected')]
      .map(b=>b.dataset.id);

  if(!selected.length) return toast("Choose members","danger");

  for(const sid of selected){
    // skip duplicates
    if(CACHE.participations.find(p=>String(p.studentId)===sid && String(p.eventId)===evId))
      continue;

    const newKey = push(ref(db,'participations'));
    await set(newKey,{
      id:Date.now().toString(),
      eventId:evId,
      studentId:sid,
      teamId:LEADER.teamId,
      status:"pending",
      submittedAt:Date.now()
    });
  }

  toast("Submitted successfully");
  document.querySelectorAll('#membersSelection .small-box.selected').forEach(b=>b.classList.remove('selected'));
  updateSelectionInfo();
});

/* ---------- DASHBOARD STATS ---------- */
function computeAttendancePercent(){
  if(!LEADER.active) return 0;

  const members = CACHE.students
    .filter(s=>String(s.teamId)===String(LEADER.teamId))
    .map(s=>String(s.id));

  let present=0, total=0;

  Object.values(CACHE.attendance).forEach(session=>{
    if(!session.students) return;
    members.forEach(id=>{
      if(session.students[id]){
        total++;
        if(session.students[id]==="present") present++;
      }
    });
  });

  if(total===0) return 0;
  return Math.round((present/total)*100);
}

function renderDashboard(){
  if(!LEADER.active){
    $('statScore').textContent = "0";
    $('statMembers').textContent = "0";
    $('statAttendance').textContent = "0%";
    return;
  }

  const team = CACHE.teams.find(t=>String(t.id)===String(LEADER.teamId));
  $('statScore').textContent = team ? (team.score||0) : 0;

  const members = CACHE.students.filter(s=>String(s.teamId)===String(LEADER.teamId));
  $('statMembers').textContent = members.length;

  $('statAttendance').textContent = computeAttendancePercent()+"%";

  // Team List
  const wrap = $('teamMembersList');
  wrap.innerHTML = "";
  members.forEach(m=>{
    wrap.innerHTML += `<div style="padding:6px;border-bottom:1px solid #eef1ff">
      <b>${escapeHtml(m.name)}</b> <span class="muted-small">(${m.id})</span>
    </div>`;
  });
}

/* ---------- RENDER RESULTS ---------- */
function renderResultsTable(){
  const tbody = $('leaderResultsTable');
  let rows="";

  CACHE.events.forEach(ev=>{
    const pos = CACHE.results.filter(r=>String(r.eventId)===String(ev.id));

    const getName = pos=>{
      const s = CACHE.students.find(st=>String(st.id)===String(pos?.studentId));
      return s ? `${s.name} (${s.id})` : "";
    };

    const r1 = pos.find(p=>p.position==1);
    const r2 = pos.find(p=>p.position==2);
    const r3 = pos.find(p=>p.position==3);

    const published = (r1?.published || r2?.published || r3?.published)
      ? `<span class="badge bg-success">Published</span>`
      : `<span class="badge bg-secondary">Draft</span>`;

    rows += `
      <tr>
        <td>${ev.name}</td>
        <td>${getName(r1)}</td>
        <td>${getName(r2)}</td>
        <td>${getName(r3)}</td>
        <td>${published}</td>
      </tr>`;
  });

  tbody.innerHTML = rows;
}

/* ---------- RENDER ALL ---------- */
function renderAll(){
  populateEventsList();
  renderDashboard();
  renderResultsTable();
}

setTimeout(()=>renderAll(),800);

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>